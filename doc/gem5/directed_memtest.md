## Starlink Directed MemTest

### 1. Introduction

Starlink Directed MemTest is used to generate and feed memory trace(instruction) into the Directed Memory Tester, which will then issue memory requests in gem5 to trigger the memory test in the pattern required.

Currently, the framework consists of 3 components:
1. `starfive_memtest_IR.py` (inside submodule)
2. `starfive_memtest_Pseudo.py` (inside submodule)
3. `directed_memtest.cc` (integrated into gem5 source)


### 2. Framework
The overall architecture of the framework is shown in the `directed_memtest_mannual.pdf`. Basically, for one specific memory pattern, we have four types of files to represent(or define):
1. `Memory Pattern Generator` (**Pure Python code**): Python code, used to generate pseudo instructions based on the arguments/parameters provided. **e.g.** `microbench/test.py`, `microbench/unit_test.py`.
2. `Pseudo Instructions` (**Text, Python like**): Text file in Python grammar, can be generated by `Memory Pattern Generator` or written mannually. It contains all pseudo instructions the memory pattern is composed of. Suffix with `.pseudo`
3. `IR Instructions` (**Text, Python like**): Text file in Python grammar, can be generated from `Pseudo Instructions` or written mannually. It maps the pseudo instruction(high-level) to its corresponding underlying implementations in Directed Memory Tester (`directed_memtest.cc`, low-level). Suffix with `.IR`
4. `Binary Instructions` (**Binary file**): Binary file, can be generated from `IR Instructions` or **other custom generators**. It directly represents the binary instructions that can be read and executed by the Directed Memory Tester (`directed_memtest.cc`) in gem5. Suffix with `.bin`

To support such framework, two Python modules are implemented:
1. `microbench_primitives/starfive_memtest_Pseudo.py`: Translate `Pseudo Instructions` into `IR Instructions`
2. `microbench_primitives/starfive_memtest_IR.py`: Translate `IR Instructions` into `Binary Instructions`

For how to invoke these two moduels, refer to `microbench/test.py` and `microbench/unit_test.py`

### 3. Run Test
To run the Directed MemTest, you firstly need to at least prepare for the `Binary Instructions` file. The number of files should be equal to the number of testers you specify in the **YAML configuration file** (usurally `num-cpus`). If one tester doesn't need to do anything, you should also provide a blank file for it to use.

As a starting point, you could run the following command and check the files generated by this generator
```bash
python3 microbench/unit_test.py
```

After all preparation has been done, you can refer to `test_config/microbenchmark/directed_memtest.yaml` and modify the parameter `trace-path` to point to the location where binary instruction files reside. Then, triggering the test using this configuration file.

### 4. Pseudo Instructions Illustration

Refer to the Python module code for more information
